<div class="row">
    <div id="validation_error">
    </div>
    <div class="col-lg-7">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Game: <%=Game.name%></h3>
            </div>
            <div class="panel-body">
                <canvas id="main_canvas"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Chat</h3>
            </div>
            <div class="panel-body">
                <ul id="chat_messages" class="list-group">
                    wait...
                </ul>
                <form id="chat-form">
                    <input id='message_text' name='text' class="form-control" type="text" />
                    <input name='game' type="hidden" value="<%=Game.id%>" />
                    <a href="/" class="btn btn-lg btn-default btn-block" id="send_message">send</a>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready( function () {
        draw_map(<%=Game.mapData%>);
        start_websocket("<%=AppState.sid%>", "<%=AppState.username%>");

        document.onkeydown = function(event) {
            if (!(event.keyCode in pressed_keys))
                return;
            pressed_keys[event.keyCode] = true;
            if (!pressed)
                key_hold("<%=AppState.sid%>");
        };
        document.onkeyup = function(event) {
            if (!(event.keyCode in pressed_keys))
                return;
            pressed = pressed_keys[event.keyCode] = false;
            for (i in pressed_keys)
                pressed = pressed || pressed_keys[i];
        };

        $('#main_canvas').click(function (e)
        {
            var offset = $(this).offset();
            var x = e.clientX - offset.left,
                    y = e.clientY - offset.top;
            fire(x, y, "<%=AppState.sid%>");
        })
    })
</script>
